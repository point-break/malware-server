import {verifyToken} from 'auth/lib/token'

export default (req, res, next) => {
  const authCookie = req.cookies[`${process.env.APP_CODE}_auth`]
  if (!authCookie) {
    res.locals.auth = null
    return next()
  }
  const token = verifyToken(authCookie, process.env.JWT_SECRET)
  if (token instanceof Error) {
    res.cookie(`${process.env.APP_CODE}_auth`, {}, {expires: new Date()})
    res.locals.user = null
    return next()
  }
  res.locals.user = token
  next()
}
