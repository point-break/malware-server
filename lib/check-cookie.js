import {verifyToken} from 'auth/lib/token'

export default (req, res, next) => {
  const authCookie = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjAxN2IxYjM3LTJlZGEtNGVlMy1iYTNmLWZiMzNmMTk0M2RiNCIsInByZWZlcnJlZE5hbWUiOiJMdWtlIEpvaG4iLCJpYXQiOjE0Njk4ODU1MDIsImV4cCI6MTQ5NjY2OTUwMn0.ibnsdPkh9qyPeghCSDzb99WGZG7s2Le16d7h-40751M'

  // req.cookies[`${process.env.APP_CODE}_auth`]
    
  if (!authCookie) {
    res.locals.auth = null
    return next()
  }
  const token = verifyToken(authCookie, process.env.JWT_SECRET)
  if (token instanceof Error) {
    res.cookie(`${process.env.APP_CODE}_auth`, {}, {expires: new Date()})
    res.locals.user = null
    return next()
  }
  res.locals.user = token
  next()
}
